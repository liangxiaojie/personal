---
layout: post
title: 什么是闭包(Closure)？
description: 什么是闭包(Closure)？深入理解 JavaScript 闭包
modified: 2017-06-01
tags:
  - JavaScript
  - Closure
  - 闭包
  - 什么是闭包？
  - 闭包的用途
image:
  feature: abstract-5.jpg
---

## 什么是闭包？

首先 闭包（closure）是一种特殊的函数，

闭包（closure）是指有权访问 另一个函数作用域 中的变量 的函数，一个持有外部环境变量的函数就是闭包。

因为该函数可以访问它被创建时所处的上下文环境，这被称为闭包。

闭包就是能够读取其他函数内部变量的函数。

当内部函数拥有比它的外部函数更长的生命周期时，内部函数引用的外部函数变量不会被释放

内部函数可以访问真正的外部变量，而不是外部变量的副本。 函数可以访问它被创建时的所有上下文变量，这就叫做闭包现象。

## 闭包的作用

1、保护函数内的变量安全。以最开始的例子为例，函数a中i只有函数b才能访问，而无法通过其他途径访问到，因此保护了i的安全性。

2、在内存中维持一个变量。依然如前例，由于闭包，函数a中i的一直存在于内存中，因此每次执行c()，都会给i自加1。
以上两点是闭包最基本的应用场景，很多经典案例都源于此。


## 闭包的优缺点

好处：灵活方便，可封装

缺点：空间浪费、内存泄露、性能消耗

由于闭包会携带包含它的函数的作用域，因此会比其他函数占用更多的内存。过度使用闭包可能会导致内存占用过多，建议只在绝对必要时再考虑使用闭包。虽然像V8等优化后的JavaScript引擎会尝试回收被闭包占用的内存，还是要慎重使用闭包。

闭包的缺点就是常驻内存，会增大内存使用量，使用不当很容易造成内存泄露。

闭包是javascript语言的一大特点，主要应用闭包场合主要是为了：设计私有的方法和变量。

一般函数执行完毕后，局部活动对象就被销毁，内存中仅仅保存全局作用域。但闭包的情况不同！

嵌套函数的闭包

~~~ javascript
   function aaa() {
          var a = 1;
          return function(){
           alert(a++)
          };
        }
        var fun = aaa();
        fun();// 1 执行后 a++，，然后a还在~
        fun();// 2
        fun = null;//a被回收！！
~~~

闭包会使变量始终保存在内存中，如果不当使用会增大内存消耗。


## Javascript的垃圾回收机制

在Javascript中，如果一个对象不再被引用，那么这个对象就会被GC回收。如果两个对象互相引用，而不再被第3者所引用，那么这两个互相引用的对象也会被回收。因为函数a被b引用，b又被a外的c引用，这就是为什么函数a执行后不会被回收的原因。

## 深入理解闭包

## 闭包的应用场景

创建闭包的最常见的方式就是在一个函数内创建另一个函数，通过另一个函数访问这个函数的局部变量
